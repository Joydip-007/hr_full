# HR Database Deployment Guide for Render.com

Complete guide to deploying the HR Database application on Render.com with the latest 2024 UI.

## Table of Contents
1. [Introduction](#introduction)
2. [Prerequisites](#prerequisites)
3. [Option 1: One-Click Blueprint Deployment](#option-1-one-click-blueprint-deployment-recommended)
4. [Option 2: Manual Deployment](#option-2-manual-deployment)
5. [Database Setup](#database-setup)
6. [Environment Variables Reference](#environment-variables-reference)
7. [Troubleshooting Guide](#troubleshooting-guide)
8. [Render UI Guide (2024)](#render-ui-guide-2024)
9. [Free Tier Limitations](#free-tier-limitations)
10. [Production Checklist](#production-checklist)
11. [Monitoring and Maintenance](#monitoring-and-maintenance)

---

## Introduction

This application consists of three main components:
- **Backend API**: Node.js/Express web service
- **Frontend**: React static site
- **Database**: PostgreSQL (recommended for Render) or MySQL

Render.com offers two deployment methods:
1. **Blueprint (render.yaml)**: One-click deployment of all services
2. **Manual**: Create each service separately with full control

---

## Prerequisites

Before you begin, ensure you have:

- ‚úÖ A GitHub account with this repository forked/cloned
- ‚úÖ A Render.com account (free tier available at https://render.com)
- ‚úÖ Git repository connected to Render
- ‚úÖ Basic understanding of environment variables

### Important Notes

- **Database Choice**: Render's free tier PostgreSQL is recommended. MySQL requires Docker which has limitations on free tier.
- **Cold Starts**: Free tier services spin down after 15 minutes of inactivity. First request after inactivity may take 30-60 seconds.
- **Build Time**: Initial deployment takes 5-10 minutes for all services.

---

## Option 1: One-Click Blueprint Deployment (Recommended)

The `render.yaml` file in the repository root enables automatic deployment of all services.

### Step 1: Access Render Dashboard

1. Go to https://render.com and log in
2. Click the **"New +"** button in the top right corner
3. Select **"Blueprint"** from the dropdown menu

### Step 2: Connect Repository

1. If this is your first time:
   - Click **"Connect GitHub"** or **"Connect GitLab"**
   - Authorize Render to access your repositories
   - Select the organization/account
2. Find and select your **hr_full** repository
3. Render will automatically detect the `render.yaml` file

### Step 3: Configure Blueprint

1. Review the services that will be created:
   - `hr-backend` (Web Service)
   - `hr-frontend` (Static Site)
   - `hr-postgres-db` (PostgreSQL Database)

2. **Set Required Environment Variables**:
   
   The blueprint will prompt you for values marked with `sync: false`:
   
   **For hr-backend:**
   - `DB_HOST`: Will be auto-populated after database creation
     - Format: `dpg-xxxxx-a.oregon-postgres.render.com`
     - Or use: `hr-postgres-db` (internal hostname)
   - `DB_USER`: Will be auto-populated (usually `hr_postgres_db_user`)
   - `DB_PASSWORD`: Will be auto-generated by Render
   - `FRONTEND_URL`: Will be your frontend URL
     - Format: `https://hr-frontend.onrender.com`
     - Update this after frontend deploys
   
   **For hr-frontend:**
   - `REACT_APP_API_URL`: Will be your backend URL
     - Format: `https://hr-backend.onrender.com`
     - Update this after backend deploys

3. Click **"Apply"** to start deployment

### Step 4: Monitor Deployment

1. Render will create all three services simultaneously
2. Database typically completes first (2-3 minutes)
3. Backend and frontend follow (5-10 minutes each)
4. Watch the logs in each service's dashboard

### Step 5: Update Environment Variables

After all services are deployed:

1. Go to **hr-backend** service
2. Click **"Environment"** in the left sidebar
3. Update `FRONTEND_URL` with the actual frontend URL
4. Update `DB_HOST` if using internal hostname: `hr-postgres-db`
5. Click **"Save Changes"** - service will redeploy

6. Go to **hr-frontend** service
7. Click **"Environment"**
8. Update `REACT_APP_API_URL` with the actual backend URL
9. Click **"Save Changes"** - service will redeploy

### Step 6: Initialize Database

See [Database Setup](#database-setup) section below.

---

## Option 2: Manual Deployment

For more control, create each service separately.

### Step 1: Create PostgreSQL Database

1. From Render Dashboard, click **"New +"** ‚Üí **"PostgreSQL"**
2. Configure:
   - **Name**: `hr-postgres-db`
   - **Database**: `hr_database`
   - **User**: Auto-generated (e.g., `hr_postgres_db_user`)
   - **Region**: `Oregon (US West)`
   - **Plan**: `Free`
3. Click **"Create Database"**
4. Wait for status to show **"Available"** (~2-3 minutes)
5. **Save these values** (found in "Info" tab):
   - Internal Database URL
   - External Database URL
   - Hostname
   - Port
   - Database name
   - Username
   - Password

### Step 2: Deploy Backend Web Service

1. Click **"New +"** ‚Üí **"Web Service"**
2. Connect your repository
3. Configure:
   - **Name**: `hr-backend`
   - **Region**: `Oregon (US West)`
   - **Branch**: `main`
   - **Root Directory**: `backend`
   - **Runtime**: `Node`
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Plan**: `Free`

4. Add Environment Variables (click "Advanced" ‚Üí "Add Environment Variable"):
   ```
   PORT=5000
   NODE_ENV=production
   DB_HOST=<from database info - hostname>
   DB_USER=<from database info - username>
   DB_PASSWORD=<from database info - password>
   DB_NAME=hr_database
   DB_PORT=5432
   DB_SSL=true
   JWT_SECRET=<generate a strong random string>
   FRONTEND_URL=<will add after frontend deploys>
   ```

   **To generate JWT_SECRET**, use:
   ```bash
   node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
   ```
   Or use an online generator: https://randomkeygen.com/

5. Configure Health Check:
   - **Health Check Path**: `/health`

6. Click **"Create Web Service"**
7. Save the deployed URL (e.g., `https://hr-backend.onrender.com`)

### Step 3: Deploy Frontend Static Site

1. Click **"New +"** ‚Üí **"Static Site"**
2. Connect your repository
3. Configure:
   - **Name**: `hr-frontend`
   - **Region**: `Oregon (US West)`
   - **Branch**: `main`
   - **Root Directory**: `frontend`
   - **Build Command**: `npm install && npm run build`
   - **Publish Directory**: `build`

4. Add Environment Variable:
   ```
   REACT_APP_API_URL=<your backend URL from Step 2>
   ```
   Example: `https://hr-backend.onrender.com`

5. Click **"Create Static Site"**
6. Save the deployed URL (e.g., `https://hr-frontend.onrender.com`)

### Step 4: Update Backend CORS

1. Go back to **hr-backend** service
2. Click **"Environment"** in left sidebar
3. Add/Update:
   ```
   FRONTEND_URL=<your frontend URL from Step 3>
   ```
   Example: `https://hr-frontend.onrender.com`

4. Click **"Save Changes"**
5. Backend will automatically redeploy (~2-3 minutes)

---

## Database Setup

After database is created and backend is deployed, initialize the schema and data.

### Method 1: Using Render Shell (Recommended)

1. Go to your **hr-postgres-db** database in Render Dashboard
2. Click **"Shell"** tab (on the right side of the page)
3. Wait for shell to connect
4. You're now in the PostgreSQL prompt

**Note**: The schema and seed files are written for MySQL. You'll need to convert them for PostgreSQL or use MySQL with Docker.

#### For PostgreSQL (Conversion Required)

The existing `schema.sql` and `seed.sql` are MySQL-specific. Main differences:
- PostgreSQL uses `SERIAL` instead of `AUTO_INCREMENT`
- PostgreSQL uses `TEXT` instead of `VARCHAR` for long strings
- Some date/time functions differ

**Quick PostgreSQL Schema** (simplified example):
```sql
-- Create tables with PostgreSQL syntax
CREATE TABLE Location (
    location_id SERIAL PRIMARY KEY,
    city VARCHAR(100) NOT NULL,
    state VARCHAR(100) NOT NULL,
    country VARCHAR(100) NOT NULL,
    address TEXT
);

-- Continue with other tables...
```

#### Using MySQL with Docker (Alternative)

If you prefer MySQL, you can deploy a MySQL instance using the provided Dockerfile:

1. Create a new **Web Service** on Render
2. Use **Docker** runtime instead of Node
3. Point to `database/Dockerfile`
4. Set environment variables:
   ```
   MYSQL_ROOT_PASSWORD=<strong-password>
   MYSQL_DATABASE=hr_database
   ```
5. Expose internal port: `3306`

Then update backend `DB_HOST` to point to this MySQL service.

### Method 2: Using Local MySQL Client

If you have MySQL locally and want to populate a remote database:

1. Get the external database URL from Render
2. Install MySQL client locally
3. Run:
   ```bash
   mysql -h <hostname> -P <port> -u <username> -p<password> hr_database < database/schema.sql
   mysql -h <hostname> -P <port> -u <username> -p<password> hr_database < database/seed.sql
   ```

### Method 3: Using pgAdmin or DBeaver

1. Download pgAdmin (PostgreSQL) or DBeaver (multi-database)
2. Create new connection using database credentials from Render
3. Open SQL editor
4. Copy contents of `schema.sql` (converted to PostgreSQL)
5. Execute
6. Repeat with `seed.sql`

### Verify Database

After running schema and seed files:

1. Check backend logs: Should see "‚úì Database connected successfully"
2. Test API endpoint: `https://your-backend.onrender.com/health`
3. Test data endpoint: `https://your-backend.onrender.com/api/locations`

---

## Environment Variables Reference

### Backend Environment Variables

| Variable | Description | Example | Required |
|----------|-------------|---------|----------|
| `PORT` | Server port | `5000` | Yes |
| `NODE_ENV` | Environment mode | `production` | Yes |
| `DB_HOST` | Database hostname | `dpg-xxxxx.oregon-postgres.render.com` | Yes |
| `DB_USER` | Database user | `hr_postgres_db_user` | Yes |
| `DB_PASSWORD` | Database password | `<auto-generated>` | Yes |
| `DB_NAME` | Database name | `hr_database` | Yes |
| `DB_PORT` | Database port | `5432` (PostgreSQL) or `3306` (MySQL) | Yes |
| `DB_SSL` | Enable SSL for DB | `true` (production), `false` (local) | No |
| `JWT_SECRET` | Secret for JWT tokens | `<random-64-char-string>` | Yes |
| `FRONTEND_URL` | Frontend URL for CORS | `https://hr-frontend.onrender.com` | Yes |

### Frontend Environment Variables

| Variable | Description | Example | Required |
|----------|-------------|---------|----------|
| `REACT_APP_API_URL` | Backend API URL | `https://hr-backend.onrender.com` | Yes |

**Important**: Frontend env vars must start with `REACT_APP_` to be accessible in React.

---

## Troubleshooting Guide

### Common Issues and Solutions

#### 1. Service Won't Start

**Symptoms**: Service status shows "Build failed" or "Deploy failed"

**Solutions**:
- Check logs in Render dashboard (Click service ‚Üí "Logs" tab)
- Verify build command is correct
- Ensure all dependencies are in `package.json`
- Check Node version compatibility

#### 2. Database Connection Failed

**Symptoms**: Backend logs show "Database connection failed"

**Solutions**:
- Verify database is in "Available" status
- Check all DB environment variables are set correctly
- Use internal database URL for better reliability
- Ensure `DB_SSL=true` for production
- Test connection in database shell

#### 3. CORS Errors

**Symptoms**: Browser console shows "Access-Control-Allow-Origin" errors

**Solutions**:
- Verify `FRONTEND_URL` in backend matches exact frontend URL
- Include protocol: `https://` not `http://`
- Check for trailing slashes (should match)
- Redeploy backend after changing CORS settings

#### 4. 404 Errors on Frontend Routes

**Symptoms**: Direct navigation to routes like `/positions` returns 404

**Solutions**:
- Add `_redirects` file in `frontend/public/`:
  ```
  /*    /index.html   200
  ```
- This ensures React Router handles all routes

#### 5. Environment Variables Not Working

**Symptoms**: App behaves as if env vars are undefined

**Solutions**:
- Frontend: Ensure vars start with `REACT_APP_`
- Rebuild service after changing env vars
- Check for typos in variable names
- Use `console.log` to debug (remove in production)

#### 6. Slow First Load (Cold Start)

**Symptoms**: First request takes 30-60 seconds

**Solutions**:
- This is normal for Render free tier
- Services spin down after 15 minutes of inactivity
- Consider upgrade to paid tier for always-on services
- Use a monitoring service to ping periodically (see Maintenance section)

#### 7. Build Timeout

**Symptoms**: "Build exceeded time limit"

**Solutions**:
- Check for large dependencies
- Optimize `package.json`
- Consider using build cache
- May need paid tier for complex builds

#### 8. Database Connection Timeout

**Symptoms**: "Connection timeout" in logs

**Solutions**:
- Increase timeout in `database.js`:
  ```javascript
  connectTimeout: 60000,
  acquireTimeout: 60000,
  ```
- Check database is in same region as backend
- Verify network isn't blocked

---

## Render UI Guide (2024)

### Dashboard Navigation

**Main Dashboard**:
- Top bar: "New +" button (blue, right side) - Create new services
- Left sidebar: 
  - "Dashboard" - Overview of all services
  - Your services listed individually
- Center: Service cards showing status

**Service Details Page**:
- Top tabs: "Overview", "Logs", "Events", "Metrics"
- Left sidebar:
  - "Settings" - General configuration
  - "Environment" - Environment variables
  - "Redirects/Rewrites" - URL rules (static sites only)
  - "Deploys" - Deployment history
  - "Shell" - Terminal access (databases only)

### Creating Services (2024 UI)

1. **New + Button Location**: Top right, blue button with plus icon
2. **Service Type Menu**: Dropdown appears with options:
   - Web Service
   - Static Site
   - Private Service
   - Cron Job
   - PostgreSQL
   - Redis
   - Blueprint

### Managing Environment Variables

1. Click service name from dashboard
2. Click "Environment" in left sidebar
3. Two sections:
   - **Environment Variables**: Key-value pairs
   - **Secret Files**: For certificate files, etc.
4. Click "Add Environment Variable" (blue button)
5. Enter key and value
6. Click "Save Changes" (triggers redeploy)

### Viewing Logs

1. Click service name
2. Click "Logs" tab at top
3. Real-time logs appear
4. Use search box to filter
5. Click "Download Logs" for full export

### Database Shell Access

1. Go to database service
2. Click "Shell" tab (may be on right side)
3. Wait for connection (~5-10 seconds)
4. You're now in PostgreSQL/MySQL prompt
5. Type SQL commands directly

### Manual Deploy/Redeploy

1. Go to service
2. Click "Manual Deploy" in top right
3. Select branch
4. Click "Deploy"
5. Watch logs for progress

---

## Free Tier Limitations

Render's free tier includes:

### Resources
- **Web Services**: 750 hours/month (shared across all web services)
- **Bandwidth**: 100 GB/month
- **Build Minutes**: Unlimited
- **Databases**: 
  - PostgreSQL: 1 GB storage, expires after 90 days
  - No MySQL (use PostgreSQL or paid tier)

### Limitations
- ‚ö†Ô∏è **Spin Down**: Services sleep after 15 minutes of inactivity
- ‚ö†Ô∏è **Cold Start**: 30-60 seconds to wake up
- ‚ö†Ô∏è **Database Expiration**: Free PostgreSQL expires after 90 days
- ‚ö†Ô∏è **No Custom Domains**: Available on paid plans only
- ‚ö†Ô∏è **Shared Resources**: Performance varies with load

### Recommendations
- Use PostgreSQL for database (free tier supported)
- Keep services in same region for better performance
- Monitor usage to avoid overages
- Consider paid tier ($7/month) for production apps
- Set up database backups before 90-day expiration

---

## Production Checklist

Use this checklist before going live. See also: [PRODUCTION_CHECKLIST.md](PRODUCTION_CHECKLIST.md)

### Pre-Deployment
- [ ] All services created and deployed
- [ ] Database schema and seed data loaded
- [ ] All environment variables configured
- [ ] JWT_SECRET is strong and unique
- [ ] CORS configured for correct frontend URL

### Post-Deployment Testing
- [ ] Health check endpoint responds: `/health`
- [ ] Frontend loads without errors
- [ ] User registration works
- [ ] User login works
- [ ] View positions list
- [ ] Apply to a position
- [ ] Admin login works
- [ ] Admin dashboard accessible
- [ ] No console errors in browser

### Security
- [ ] No secrets in code or logs
- [ ] Environment variables used for all sensitive data
- [ ] CORS restricted to frontend URL only
- [ ] JWT_SECRET is cryptographically random
- [ ] Database password is strong

### Performance
- [ ] All services show "Live" status
- [ ] API responses under 2 seconds
- [ ] Frontend loads under 3 seconds
- [ ] No timeout errors in logs

---

## Monitoring and Maintenance

### Regular Monitoring

**Daily/Weekly**:
- Check service status in Render dashboard
- Review logs for errors
- Monitor database storage usage

**Monthly**:
- Review bandwidth usage
- Check for security updates
- Backup database (before 90-day expiration)

### Keep Services Awake (Optional)

Free tier services spin down after 15 minutes. To keep them awake:

**Option 1: UptimeRobot** (Recommended)
1. Sign up at https://uptimerobot.com (free)
2. Create new monitor
3. Type: HTTP(s)
4. URL: `https://hr-backend.onrender.com/health`
5. Monitoring interval: 5 minutes
6. Sends ping to keep service awake

**Option 2: Cron-job.org**
1. Sign up at https://cron-job.org (free)
2. Create new cron job
3. URL: Your backend health endpoint
4. Schedule: Every 5-10 minutes

**Note**: This uses more of your free tier hours. Monitor usage to avoid hitting limits.

### Database Backups

**Before 90-day expiration** (free tier limitation):

1. Go to database in Render dashboard
2. Click "Info" tab
3. Copy External Database URL
4. Use `pg_dump` to backup:
   ```bash
   pg_dump <external-database-url> > backup.sql
   ```
5. Store backup securely
6. Create new free database and restore if needed

**Automated Backups** (Paid Tier):
- Available on PostgreSQL paid plans
- Automatic daily backups
- Point-in-time recovery
- Longer retention periods

### Logs and Debugging

**Access Logs**:
1. Service ‚Üí Logs tab
2. Real-time streaming
3. Filter by log level or text
4. Download full logs if needed

**Common Log Patterns**:
```
‚úì Database connected successfully - Good
‚úó Database connection failed - Check env vars
CORS error - Check FRONTEND_URL
404 - Check routes
500 - Check backend logs for stack trace
```

### Updating the Application

**Deploy New Changes**:
1. Push changes to GitHub
2. Render auto-deploys if connected (if auto-deploy enabled)
3. Or manually trigger deploy in Render dashboard
4. Watch logs for errors
5. Test after deployment

**Rolling Back**:
1. Go to service
2. Click "Deploys" in left sidebar
3. Find previous successful deploy
4. Click "Rollback" button

---

## Additional Resources

### Render Documentation
- Official Docs: https://render.com/docs
- Service Types: https://render.com/docs/service-types
- Databases: https://render.com/docs/databases
- Environment Variables: https://render.com/docs/environment-variables

### HR Database Application
- Main README: [README.md](README.md)
- Production Checklist: [PRODUCTION_CHECKLIST.md](PRODUCTION_CHECKLIST.md)
- GitHub Repository: [Your Repository URL]

### Support
- Render Community: https://community.render.com
- Render Status: https://status.render.com

---

## Summary

**Quick Setup (Blueprint)**:
1. Fork repository
2. Create Render account
3. New + ‚Üí Blueprint ‚Üí Select repo
4. Configure environment variables
5. Deploy
6. Initialize database
7. Test application

**Manual Setup**:
1. Create PostgreSQL database
2. Deploy backend web service
3. Deploy frontend static site
4. Connect services with environment variables
5. Initialize database
6. Test application

**Next Steps**:
- Complete [Production Checklist](PRODUCTION_CHECKLIST.md)
- Set up monitoring
- Enable auto-deploy from GitHub
- Consider custom domain (paid tier)

---

**Happy Deploying! üöÄ**

If you encounter issues not covered in this guide, check:
1. Service logs in Render dashboard
2. Browser console (F12) for frontend errors
3. [Troubleshooting section](#troubleshooting-guide) above
4. Render community forums
